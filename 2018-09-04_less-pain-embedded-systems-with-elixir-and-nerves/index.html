<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Less-Pain Embedded Systems with Elixir and Nerves</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">
    <link rel="stylesheet" href="css/customizations.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

        <!-- Welcome -->

        <section>

          <section data-markdown class="title">
            <textarea data-template>
              # Less-Pain
              # Embedded Systems
              # with Elixir and Nerves

              ----

              ElixirConf US 2018 - 2018-09-04 + 05

              Greg Mefford &amp; Tim Mecklem

              ![GregMefford](img/headshot_glowsticks.jpeg) <!-- .element: class="plain" style="height: 6em" -->
              ![Tim Mecklem](img/tim-mecklem.jpg) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Thanks, Bleacher Report!
              ![GregMefford](img/headshot_glowsticks.jpeg) <!-- .element: class="plain" style="height: 10em" -->
              ![Bleacher Report logo](img/BR_Logo_White.png) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Thanks, Gaslight!
              ![Tim Mecklem](img/tim-mecklem.jpg) <!-- .element: class="plain" style="height: 10em" -->
              ![Gaslight logo](img/gaslight.jpg) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Code of Conduct 💜

              http://lonestarelixir.com/2018/code-of-conduct
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule 🕘

              * 7:30 AM - 8:30 AM (1:00)
                * Registration/Breakfast
              * 8:30 AM - 10:00 AM (1:30)
                * Welcome / Overview
                * Build some Hardware
                * Pre-Burned Firmware!
                * Project Overview
              *  10:00 AM - 10:30 AM (0:30)
                * Break (and help resolve issues)
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule 🕘

              *  10:30 AM - 12:00 PM (1:30)
                * Elixir for Embedded
                * Nerves Concepts
                * Streaming Video
                * Application Structure
                * Custom Nerves Systems
              *  12:00 PM - 1:30 PM (1:30)
                * Lunch (and explore Buildroot)
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule 🕘

              *  1:30 PM - 3:00 PM (1:30)
                * Scanning Barcodes
                * GraphQL APIs
              *  3:00 PM - 3:30 PM (0:30)
                * Break
              *  3:30 PM - 5:00 PM (1:30)
                * Adding Phoenix
                * Phoenix Channels
                * GraphQL Subscriptions
                * Play / Lab time
            </textarea>
          </section>

        </section>

        <!-- Hardware Overview -->

        <section>

          <section data-background-image="img/hardware_overview.jpg" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # For Today

              * Raspberry Pi Zero W + case
              * Pi camera v2
              * Zero-size camera ribbon cable
              * Lens adjustment tool
              * 16 GB class 10 MicroSD card
              * MicroSD card reader
              * Male USB to MicroUSB cable
              * QR codes and Stickers!
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # For Later

              * MicroUSB OTG cable
              * HDMI to Mini HDMI cable
              * Standard-size camera ribbon cable
              * 5V 2.5A MicroUSB AC power adapter
              * 40-pin header
              * Heatsink
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Electronics Safety

              * Touch some grounded metal (like your laptop)
              * It's technically not fine, but it'll probably be fine
              * Be gentle with the ribbon cables/connectors
            </textarea>
          </section>

          <section data-background-image="img/hardware_assembly_01.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_02.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_07.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_06.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_03.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_04.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_05.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_06.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_07.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_08.jpg" data-background-size="contain">
          </section>

        </section>

        <!-- Quick Win Firmware / Project Overview -->

        <section>

          <section data-background-image="img/quick_win.jpg" data-background-size="contain">
          </section>

          <section data-markdown>
            <textarea data-template>
              # Eye

              ![Eye](img/eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Omni Eye

              ![Eye](img/omni_eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
              <br/>
              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Streaming Video with *Picam*
              ![Picam](img/picam.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/electricshaman/picam](https://github.com/electricshaman/picam) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Scanning Barcodes with *Zbar*
              ![zbar-elixir](img/zbar-elixir.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/GregMefford/zbar-elixir](https://github.com/GregMefford/zbar-elixir) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # GraphQL Queries, Mutations
              # and Subscriptions

              ![Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](img/graphql_subscriptions.png) <!-- .element: class="plain" style="height: 10em" -->
              <br/>
              [Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](https://youtu.be/PEckzwggd78) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix Channels
              ![Channels](img/channels.png) <!-- .element: class="plain" style="height: 12em" -->

              Notes:

              Phoenix Channels also offer a great way to easily connect your devices

              to a server, whether it's an app running in a browser or

              a headless sensor device in the field.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              ![USB Gadget Power](img/gadget_power.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/nerves-project/nerves_init_gadget](https://github.com/nerves-project/nerves_init_gadget) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              ![USB Gadget Composite Device](img/gadget_composite.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/nerves-project/nerves_init_gadget](https://github.com/nerves-project/nerves_init_gadget) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              * Config Ethernet and Serial over USB
              * DHCP Server
              * mDNS Responder (`nerves.local`)
              * Manage Erlang Distribution
              * `mix firmware.push` over SSH
              * SSH console to IEx prompt
            </textarea>
          </section>

          <section data-background-image="img/eye_barcode.png" data-background-size="contain">
          </section>

          <section data-background-image="img/eye_tunnel.png" data-background-size="contain">
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ open http://nerves.local/
              # Try scanning a barcode (you may need to reload
              # the browser page after the device boots fully)

              $ open http://nerves.local/graphiql
              # Try running a query like:
              # query {
              #   config {
              #     size {
              #       width
              #       height
              #     }
              #   }
              # }
              ```
            </textarea>
          </section>

        </section>

        <!-- Break Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 10:00 to 10:30 AM

            * How is the pace?
            * Any questions?
            * Play with your shiny new hardware
            * Mingle in the hall
            * Get a snack, maybe?
          </textarea>
        </section>

        <!-- Elixir for Embedded -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Elixir 💜 Embedded
              Light-weight *concurrency*
              * Tons of tiny processes
              * Process-level fault-tolerance
              * Per-Process Garbage-Collection
              * Immutable Data Structures

              Notes:

              Due to its Erlang roots, Elixir was born to be embedded.

              Today's low-cost embedded platforms are yesterday's supercomputers,

              so it's unsurprising that the BEAM would work well there.

              But I want to talk for a minute about this one-two punch:

              Garbage-collection happens per-process, and data structures are immutable.
            </textarea>
          </section>

          <section data-background-image="img/gc_jvm.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Here's what a typical memory usage graph looks like for

              a Java virtual machine under a constant workload.

              The shaded areas are wasted memory due mostly to a lack of

              immutable data structures, which prevents the garbage collector

              from quickly determining what memory is still in use somewhere.
            </aside>
          </section>

          <section data-background-image="img/gc_jvm_zoom.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              If we zoom in, we see the same process, but on a smaller scale.

              When the overall memory usage hits 75%, it triggers a Full-GC that

              stops the whole VM while it determines what memory is no longer

              referenced anywhere and frees it up.

              In a busy system, this can take a while and cause problems.
            </aside>
          </section>

          <section data-background-image="img/gc_beam.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              By contrast, the BEAM does garbage-collection on a per-process basis.

              There's very little waste for a system under constant load.

              The overall memory usage only ebbs and flows with the

              actual memory requirements of your workload.

              This means that you can run a system closer to its memory limit,

              provided that your workload doesn't have large peaks and valleys.

              That can be a very important property for an embedded system with

              only half a gig of RAM.
            </aside>
          </section>

          <section data-background-image="img/gc_beam_zoom.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              If we zoom in, we see that each process allocates some memory,

              does its work,

              with tiny, independent garbage-collections along the way,

              and frees it all when it's finished.

              At any moment, there are a bunch of processes allocating a

              small increment of memory, while a much smaller number are freeing

              their entire allocation.

              So the overall memory usage closely follows the actual demand on the system.
            </aside>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Elixir 💜 Embedded
              *Binary* pattern-matching

              ``` elixir
              def decode(<<op::3, addr::6, data::7>>), do: {op, addr, data}

              # ...

              decode(<<0b01010101, 0b01010011>>) # => {2, 42, 83}
              ```

              Notes:

              Another thing that's really great about Elixir for embedded development

              is binary pattern-matching.

              Let's pretend that we have an data sheet for an electronics component

              that says we need to decode these 16 bits into

              * a 3-bit operation code,
              * a 6-bit address value,
              * and a 7-bit data value.

              It's really easy to just pattern-match like this, and you're done.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Elixir 💜 Embedded
              *Binary* pattern-matching
              ``` elixir
              def decode(<<0::2, op::1, addr::9, data::4>>), do: # ...
              def decode(<<      op::3, addr::6, data::7>>), do: # ...

              # ...

              decode(<<0b00010101, 0b01010011>>) # => {0, 341, 3}
              decode(<<0b01010101, 0b01010011>>) # => {2, 42, 83}
              ```

              Notes:

              But oh, by the way, the data sheet also says that

              if the first two bits are zeros, then you're in "extended address" mode,

              so you should interpret the rest of the data as:

              * a 1-bit operation code,
              * a 9-bit address value,
              * and a 4-bit data value.

              No problem, just add another function head.

              This example is obviously contrived, but it's so nice to be able

              to do this instead of procedural bitwise operations.
            </textarea>
          </section>

        </section>

        <!-- Nerves -->

        <section>
          <section data-markdown class="nav">
            <textarea data-template>
              ![Nerves Logo](img/nerves_sticker.png) <!-- .element: class="plain" style="height: 6em" -->

              Craft and deploy

              bulletproof embedded software

              in Elixir

              Notes:

              But I don't recommend you do that, because that's what Nerves is for.
            </textarea>
          </section>

          <section data-background-image="img/elixir_logo_on_pi.jpg">
            <aside class="notes" data-markdown>
              We basically just put Elixir on a Raspberry Pi.

              So... there you go!
            </aside>
          </section>

          <section data-background-image="img/nerves_vs_linux.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Nerves uses Buildroot to cross-compile a minimal Linux kernel and userland for you.

              It's much smaller than a normal Linux installation because

              it doesn't include all the drivers and tools you don't need to run your app.

              In fact, we replace the init process with a small program called erlinit,

              whose job is just to start the BEAM and run your app.
            </aside>
          </section>

          <section data-background-image="img/nerves_system.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              The Nerves team packages these up into what we call "systems" that

              are specific to a given hardware target, like a Raspberry Pi Zero.

              The systems we provide are really minimal,

              but you can make your own if you need to.

              We have pretty good documentation about how to do that.
            </aside>
          </section>

          <section data-background-image="img/nerves_firmware.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              When you build a Nerves "firmware," it adds your application code to

              the pre-compiled system.

              Your application is responsible for running any OS processes you need,

              for example, using an Elixir Port.

              This firmware runs from a read-only file-system on the device.

              This helps prevent file system corruption when power is suddenly

              removed from an embedded device while it's writing data, and also

              give some peace of mind that the firmware you put on the device is

              going to stay in a consistent state.

              A Nerves firmware, including your application,

              can be as small as 25 MB and boots in about 5 seconds.
            </aside>
          </section>

          <section data-background-image="img/nerves_appdata.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Of course, we also have a writable partition that you can use to

              persist your data in a place that won't corrupt your boot partition.
            </aside>
          </section>

          <section data-background-image="img/nerves_b_firmware.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              We also have a secondary "firmware slot" that you can use for

              pushing updates to a running device without having to

              re-program its SD card.
            </aside>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves Platform
              App-level fault-tolerance with *Shoehorn*
              > Get your boot on!

              * Configure network
              * Start management tooling
              * Format storage partitions
              * ... Then start your app

              Notes:

              We also have Bootloader, which can be used to ensure the device

              comes up to a known-working state before trying to start your

              application.

              This allows for some limited remote diagnostics or firmware update,

              even if your application fails to start for some reason.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves Platform
              App-level fault-tolerance with *Shoehorn*

              > *Shoehorn* used to be called *Bootloader*.
              > That was confusing because it's not actually a bootloader.
            </textarea>
          </section>

          <section data-markdown class="img-grid">
            <textarea data-template>
              # Support for *Lots of Targets*
              ![rpi0](img/rpi0.png) <!-- .element: class="plain" -->
              ![rpi1](img/rpi1.png) <!-- .element: class="plain" -->
              ![rpi2](img/rpi2.png) <!-- .element: class="plain" -->
              ![rpi3](img/rpi3.png) <!-- .element: class="plain" -->
              ![bbb](img/bbb.png) <!-- .element: class="plain" -->
              ![ev3](img/ev3.png) <!-- .element: class="plain" -->

              Notes:

              Nerves currently supports a bunch of popular and readily-available

              target hardware, like the Raspberry Pi and Beaglebone families,

              and the Lego EV3, which is really neat.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves 💜 Elixir

              ```bash
              $ mix nerves.new    # Generate a Project
              $ mix deps.get      # Download Pre-Compiled Infrastructure
              $ mix firmware      # Cross-Compile your Project
              $ mix firmware.burn # Burn your SD card
              # ... or ...
              $ mix firmware.push # Update your Firmware over the Network
              ```
            </textarea>
          </section>

          <section data-background-image="img/all_in_one_nerves.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Nerves gives you the tools you need to build, for example,

              an all-in-one touch-screen kiosk that connects to hardware devices

              and back to a central server, mostly using technologies you already know.
            </aside>
          </section>

          <section data-background-image="img/all_in_one_dev.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              ... and you can use mocks of the hardware in dev and test environments

              so that you don't need to have real hardware available.
            </aside>
          </section>

        </section>

        <!-- Phoenix for Embedded -->

        <section>

          <section data-markdown class="nav">
            <textarea data-template>
              # Phoenix 💜 "IoT"
              ![Tons of cats](img/cats.png) <!-- .element: class="plain" style="height: 12em" -->

              Notes:

              Next, let's talk about Phoenix.

              This is your server on IoT.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Avoid hard CS problems if you can

              ![The Road to 2M Websocket Connections](img/the_road_to_2m_websockets.png) <!-- .element: class="plain" style="height: 10em" -->
              <br/>
              [Gary Rennie - The Road to 2 Million Websocket Connections in Phoenix](https://youtu.be/c6JcVwbOGXc) <!-- .element: class="attribution" -->

              Notes:

              It turns out that Phoenix is pretty good at handling that

              without much special tuning or architecture.

              In this presentation, Gary describes how they were able to get a

              single server to host 2M websocket connections.

              That wasn't the limit of what's possible,

              it was more of an arbitrary point at which they ran out of time

              and motivation to keep going with the test.
            </textarea>
          </section>

          <section>
            <h1>Use all your <em>Cores</em></h1>

            <div style="float: left">
              <p>4 Cores</p>
              <img src="img/rpi3.png" class="plain" style="width: 500px" />
            </div>
            <div style="float: right">
              <p>96 Cores / 192 Threads</p>
              <img src="img/r930.png" class="plain" style="width: 500px" />
            </div>

            <aside class="notes" data-markdown>
              Phoenix does a great job of using all your cores

              (fragment) Whether it's 4 cores in your Raspberry Pi

              (fragment) or tons of cores in your beefy server hardware
            </aside>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Pretty secure by default
              ![Phoenix Security](img/phoenix_security.png) <!-- .element: class="plain" style="height: 10em" -->
              [Griffin Byatt - Plugging the Security Holes in Your Phoenix Application](https://youtu.be/w3lKmFsmlvQ) <!-- .element: class="attribution" -->

              Notes:

              Phoenix is also pretty secure by default.

              In this presentation, Griffin presented his findings from

              analyzing a lot of Phoenix-based web applications in the wild.

              My main take-away from his presentation was that,

              unless you're doing something unusual,

              Phoenix has your back and does the right thing by default.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Embedded web server
              (configuration, HMI, API)

              ![Process Controls](img/process_controls.png) <!-- .element: class="plain" style="height: 11em" -->

              Notes:

              Phoenix also makes a great embedded web server, whether you need

              a configuration page, a human-machine interface, or just a JSON API.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix Channels
              ![Channels](img/channels.png) <!-- .element: class="plain" style="height: 12em" -->

              Notes:

              Phoenix Channels also offer a great way to easily connect your devices

              to a server, whether it's an app running in a browser or

              a headless sensor device in the field.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # GraphQL Subscriptions

              ![Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](img/graphql_subscriptions.png) <!-- .element: class="plain" style="height: 10em" -->
              <br/>
              [Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](https://youtu.be/PEckzwggd78) <!-- .element: class="attribution" -->
            </textarea>
          </section>

        </section>

        <!-- Break Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 10:00 to 10:30 AM

            * How is the pace?
            * Any questions?
            * Play with your shiny new hardware
            * Mingle in the hall
            * Get a snack, maybe?
          </textarea>
        </section>

        <!-- Omni-Eye - Step 1 - Streaming Video -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Eye

              ![Eye](img/eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Omni Eye

              ![Eye](img/omni_eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
              <br/>
              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Let's Stream some Video
              ## with *Picam*

              ![Picam](img/picam.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/electricshaman/picam](https://github.com/electricshaman/picam) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step1` branch

              from the `omni_eye` repo.

              ``` bash
              $ git clone https://github.com/GregMefford/omni_eye.git
              $ cd omni_eye
              $ git checkout step1
              ```

              The following slides show how

              we arrived there step-by-step.

              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Getting Started

              ``` bash
              $ mkdir omni_eye
              $ cd omni_eye
              $ mix new eye --sup
              $ mix nerves.new eye_fw
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Getting Started

              ``` bash
              omni_eye
              ├── eye
              │   ├── README.md
              │   ├── config
              │   ├── lib
              │   ├── mix.exs
              │   └── test
              └── eye_fw
                  ├── README.md
                  ├── _build
                  ├── config
                  ├── deps
                  ├── lib
                  ├── mix.exs
                  ├── mix.lock.host
                  ├── rel
                  └── test
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Poncho Project

              ![Poncho Projects](img/poncho_projects.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [http://embedded-elixir.com/post/2017-05-19-poncho-projects/](http://embedded-elixir.com/post/2017-05-19-poncho-projects/) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defp deps do
                [
                  {:picam, "~> 0.2.0"},
                  {:cowboy, "~> 1.0.0"},
                  {:plug, "~> 1.0"}
                ]
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/mix.exs
              defp deps do
                [
                  {:nerves, "~> 0.10.0", runtime: false},
                  {:distillery, "~> 1.5"},
                  {:eye, path: "../eye"}
                ] ++ deps(@target)
              end

              defp deps("host"), do: []
              defp deps(target) do
                [
                  {:shoehorn, "~> 0.2"},
                  {:nerves_runtime, "~> 0.5"},
                  {
                    :nerves_init_gadget,
                    github: "nerves-project/nerves_init_gadget",
                    ref: "dhcp"
                  },
                ] ++ system(target)
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![nerves_init_gadget](img/nerves_init_gadget.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/nerves-project/nerves_init_gadget/tree/dhcp](https://github.com/nerves-project/nerves_init_gadget/tree/dhcp) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![nerves_init_gadget_deps](img/nerves_init_gadget_deps.png) <!-- .element: class="plain" style="height: 13em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/mix.exs
              defp system("rpi0") do
                [{:nerves_system_rpi0, "~> 0.21.0", runtime: false}]
              end
              defp system(target) do
                Mix.raise "Unsupported MIX_TARGET: #{target}"
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                use Application

                def child_spec_no_args(module) do
                  %{id: module, start: {module, :start_link, []}}
                end

                def start(_type, _args) do
                  children = [
                    child_spec_no_args(Picam.Camera),
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: 80])
                  ]

                  opts = [strategy: :one_for_one, name: Eye.Supervisor]
                  Supervisor.start_link(children, opts)
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                use Plug.Router

                plug :match
                plug :dispatch
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                get "/" do
                  markup = """
                  <!DOCTYPE html>
                  <html>
                  <head>
                    <meta charset="UTF-8" />
                    <title>Eye - Video Stream</title>
                  </head>
                  <body> <img src="video.mjpg" /> </body>
                  </html>
                  """
                  conn
                  |> put_resp_header("Content-Type", "text/html")
                  |> send_resp(200, markup)
                end
                #...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                #...
                forward "/video.mjpg", to: Eye.JPEGStreamer

                match _ do
                  send_resp(conn, 404, "Oops. Try /")
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/jpeg_streamer.ex
              defmodule Eye.JPEGStreamer do
                import Plug.Conn
                @behaviour Plug
                @boundary "w58EW1cEpjzydSCq"

                def init(opts), do: opts

                def call(conn, _opts) do
                  Eye.Camera.configure()
                  conn
                  |> put_resp_header("Age", "0")
                  |> put_resp_header("Cache-Control", "no-cache, private")
                  |> put_resp_header("Pragma", "no-cache")
                  |> put_resp_header("Content-Type",
                    "multipart/x-mixed-replace; boundary=#{@boundary}")
                  |> send_chunked(200)
                  |> send_pictures
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/jpeg_streamer.ex
              defmodule Eye.JPEGStreamer do
                # ...
                defp send_pictures(conn) do
                  conn
                  |> send_picture()
                  |> send_pictures()
                end

                defp send_picture(conn) do
                  jpg = Eye.Camera.next_frame
                  size = byte_size(jpg)
                  header = "------#{@boundary}\r\nContent-Type: image/jpeg\r\nContent-length: #{size}\r\n\r\n"
                  footer = "\r\n"
                  with {:ok, conn} <- chunk(conn, header),
                       {:ok, conn} <- chunk(conn, jpg),
                       {:ok, conn} <- chunk(conn, footer),
                    do: conn
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                require Logger

                def configure do
                  Logger.info("Configuring camera")
                  Picam.set_quality(10)
                  Picam.set_size(1280, 720)
                  Picam.set_fps(30)
                end

                def next_frame do
                  Picam.next_frame()
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/config/config.exs
              config :shoehorn,
                init: [:nerves_runtime, :nerves_init_gadget],
                app: Mix.Project.config()[:app]

              # VVV Make sure you actually have an SSH key generated VVV
              config :nerves_firmware_ssh,
                authorized_keys: [
                  File.read!(Path.join(System.user_home!, ".ssh/id_rsa.pub"))
                ]
              # ^^^ Before you burn your firmware to your SD card ^^^

              config :nerves_init_gadget,
              address_method: :static

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ cd eye_fw
              $ export MIX_TARGET=rpi0
              $ mix deps.get
              $ mix firmware
              # Extract your SD card from the Zero
              # Connect it to your laptop
              $ mix firmware.burn
              # Put it back into your Zero
              ```
              ![zero retention tab](img/hardware_assembly_07.jpg) <!-- .element: class="plain" style="height: 10em" -->
              ![tilt up the zero](img/hardware_assembly_06.jpg) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

        </section>

        <!-- Step 2 - Custom System with zbar -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Scanning Barcodes with *`zbar`*
              ![zbar-elixir](img/zbar-elixir.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/GregMefford/zbar-elixir](https://github.com/GregMefford/zbar-elixir) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Custom Nerves Systems
              ![custom system docs](img/custom_system_hexdocs.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://hexdocs.pm/nerves/systems.html#customizing-your-own-nerves-system](https://hexdocs.pm/nerves/systems.html#customizing-your-own-nerves-system) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut
              Check out the `step2` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step2
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              # Leave the eye_fw directory
              $ cd ..
              $ git clone https://github.com/nerves-project/nerves_system_rpi0.git
              $ mv nerves_system_rpi0 system_rpi0_zbar
              $ cd system_rpi0_zbar
              $ mix deps.get
              $ mix nerves.system.shell
               Nerves /nerves/build > make menuconfig
              ```
              ![system shell](img/sys_shell_01.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/sys_shell_02.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_03.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_04.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_05.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_06.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_07.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_08.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_09.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
               Nerves /nerves/build > make save-defconfig
               Nerves /nerves/build > exit
              $ git diff
              ```
            </textarea>
          </section>

          <section data-background-image="img/custom_system_diff_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_3.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_4.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ cd ../omni_eye/eye_fw
              $ export MIX_TARGET=rpi0_zbar
              ```

              ``` elixir
              # eye_fw/mix.exs
              defp system("rpi0_zbar") do
                [{:nerves_system_rpi0_zbar, path: "../../system_rpi0_zbar", runtime: false}]
              end
              defp system(target) do
                Mix.raise "Unsupported MIX_TARGET: #{target}"
              end
              ```

              ``` bash
              $ mix firmware
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ mix firmware.push 192.168.24.1
              ```
              ![mix firmware push](img/firmware_push.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/custom_system_release_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_release_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_release_3.png" data-background-size="contain"> </section>

        </section>

        <!-- Step 3 - Scanning barcodes with zbar and Plug -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Let's Actually
              # Scan some Barcodes!
              ![watch barcodes](img/step3_watch_barcodes.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step3` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step3
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defmodule Eye.MixProject do
                # ...

                defp deps do
                  [
                    {:picam, "~> 0.2.0"},
                    {:zbar, "~> 0.1.0"},
                    {:cowboy, "~> 1.0.0"},
                    {:plug, "~> 1.0"},
                    {:poison, "~> 3.1.0"}
                  ]
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/config/config.exs
              config :eye, port: 4000
              config :picam, camera: Picam.FakeCamera

              config :logger, level: :debug, utc_log: true
              config :logger, :console,
                level: :debug,
                format: "$dateT$time [$level] $message\n"
              ```

              ``` elixir
              # eye_fw/config/config.exs
              config :eye, port: 80
              config :picam, camera: Picam.Camera

              config :logger, level: :info, utc_log: true
              config :logger, :console,
                level: :info,
                format: "$dateT$time [$level] $message\n"
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                # ...
                def start(_type, _args) do
                  port = Application.get_env(:eye, :port)
                  picam_camera = Application.get_env(:picam, :camera)

                  children = [
                    child_spec_no_args(picam_camera),
                    Eye.BarcodeScanner,
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: port])
                  ]

                  opts = [strategy: :rest_for_one, name: Eye.Supervisor]
                  Supervisor.start_link(children, opts)
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                use GenServer
                alias Eye.Camera

                # BarcodeScanner API

                def next_scan(timeout \\ 10_000) do
                  GenServer.call(__MODULE__, :next_scan, timeout)
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                # ...

                # GenServer API

                def start_link(opts \\ []) do
                  GenServer.start_link(__MODULE__, opts, name: __MODULE__)
                end

                def init(_opts) do
                  send(self(), :scan_next_frame)
                  {:ok, []}
                end

                def handle_call(:next_scan, from, state) do
                  {:noreply, [from | state]}
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                # ...

                def handle_info(:scan_next_frame, state) do
                  {:ok, symbols} =
                    Camera.next_frame()
                    |> Zbar.scan()

                  dispatch(symbols, state)

                  send(self(), :scan_next_frame)
                  {:noreply, []}
                end

                # Helpers

                defp dispatch(symbols, requests) do
                  Enum.each(requests, & GenServer.reply(&1, symbols))
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                forward "/video.mjpg", to: Eye.JPEGStreamer

                get "/barcodes.json" do
                  response =
                    Eye.BarcodeScanner.next_scan()
                    |> format_symbols()
                    |> Poison.encode!()

                  conn
                  |> put_resp_header("Age", "0")
                  |> put_resp_header("Cache-Control", "no-cache, private")
                  |> put_resp_header("Pragma", "no-cache")
                  |> put_resp_header("Content-Type", "text/json")
                  |> send_resp(200, response)
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                defp format_symbols(nil), do: []
                defp format_symbols(symbols) do
                  Enum.map(symbols, & format_symbol/1)
                end

                defp format_symbol(%Zbar.Symbol{} = symbol) do
                  symbol
                  |> Map.delete(:__meta__)
                  |> Map.update!(:points, & format_points/1)
                end

                defp format_points(points) do
                  Enum.map(points, & format_point/1)
                end

                defp format_point({x, y}), do: %{x: x, y: y}
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Test images
              ![test image](img/1280_720.jpg) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              If you want to try it on your laptop

              you'll need `libjpeg` and `zbar` installed.
              ``` bash
              # NOTE: the zbar package brings in a bunch of
              # other stuff, including imagemagick
              $ brew install libjpeg zbar
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
              ![iex barcodes](img/step3_iex_scan_barcode.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Push a firmware update
              ``` bash
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Serial console
              ``` bash
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
              ![picocom](img/step3_picocom.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ watch curl -s http://192.168.24.1/barcodes.json
              ```
              ![watch barcodes](img/step3_watch_barcodes.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

        </section>

        <!-- Lunch Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 12:00 to 1:30 AM

            * How is the pace?
            * Any questions?
          </textarea>
        </section>

        <!-- Step 4 - GraphQL -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # GraphQL
              ![GraphiQL](img/step4_graphiql_query.png) <!-- .element: class="plain" -->
              ![GraphiQL](img/step4_graphiql_mutation.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step4` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step4
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/configuration.ex
              defmodule Eye.Configuration do
                @moduledoc """
                This camera configuration struct holds on to the current state of each
                `Picam` camera setting that the `Eye` application supports:

                * `size`: The image resolution as a map of `%{width: w, height: h}`.
                """

                defstruct [ size: %{width: 1280, height: 720} ]

                @typedoc @moduledoc
                @type t ::
                  %__MODULE__{
                    size: dimensions()
                  }
                @type dimensions ::
                  %{width: non_neg_integer(), height: non_neg_integer()}
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                use GenServer
                alias Eye.Configuration
                require Logger

                # Public API

                def get_config(), do: GenServer.call(__MODULE__, :get_config)

                def set_size(width, height) do
                  GenServer.call(__MODULE__, {:set_size, width, height})
                end

                defdelegate next_frame(), to: Picam

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                # ...

                # GenServer API

                def start_link(opts \\ []) do
                  GenServer.start_link(__MODULE__, opts, name: __MODULE__)
                end

                def init(_opts) do
                  Logger.info("Configuring camera")
                  conf = %Configuration{}
                  Picam.set_size(conf.size.width, conf.size.height)
                  {:ok, conf}
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                # ...

                def handle_call(:get_config, _from, conf), do: {:reply, conf, conf}

                def handle_call({:set_size, width, height}, _from, conf) do
                  case Picam.set_size(width, height) do
                    :ok ->
                      conf = %{conf | size: %{width: width, height: height}}
                      {:reply, :ok, conf}

                    err ->
                      {:reply, err, conf}
                  end
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                # ...

                  children = [
                    child_spec_no_args(picam_camera),
                    Eye.Camera,
                    Eye.BarcodeScanner,
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: port])
                  ]

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![remove camera config from streamer](img/step4_remove_camera_config_from_streamer.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defmodule Eye.MixProject do
                # ...

                defp deps do
                  [
                    {:picam, "~> 0.2.0"},
                    {:zbar, "~> 0.1.0"},
                    {:cowboy, "~> 1.0.0"},
                    {:plug, "~> 1.0"},
                    {:absinthe, "~> 1.4"},
                    {:absinthe_plug, "~> 1.4"},
                    {:poison, "~> 3.1.0"}
                  ]
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                use Plug.Router

                plug Plug.Logger
                plug Plug.Parsers,
                  parsers: [
                    :urlencoded,
                    :multipart,
                    :json,
                    Absinthe.Plug.Parser
                  ],
                  pass: ["*/*"],
                  json_decoder: Poison

                plug :match
                plug :dispatch

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...

                forward "/graphql",
                  to: Absinthe.Plug,
                  init_opts: [schema: Eye.Schema]

                forward "/graphiql",
                  to: Absinthe.Plug.GraphiQL,
                  init_opts: [
                    schema: Eye.Schema,
                    interface: :simple
                  ]

                match _ do
                  send_resp(conn, 404, "Oops. Try /")
                end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema.ex
              defmodule Eye.Schema do
                use Absinthe.Schema

                import_types Absinthe.Type.Custom
                import_types Eye.Schema.CameraTypes

                # ...
              end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema.ex
              defmodule Eye.Schema do
                # ...
                alias Eye.Resolvers

                query name: "Query" do
                  @desc "Get current camera configuration"
                  field :config, :camera_config do
                    resolve &Resolvers.Camera.get_config/3
                  end
                end

                mutation name: "Mutation" do
                  @desc "Set camera resolution"
                  field :size, :camera_config do
                    arg :width, non_null(:integer)
                    arg :height, non_null(:integer)
                    resolve &Resolvers.Camera.set_size/3
                  end
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema/camera.ex
              defmodule Eye.Schema.CameraTypes do
                use Absinthe.Schema.Notation

                @desc "Camera configuration"
                object :camera_config do
                  field :size, :dimensions
                end

                @desc "Image dimensions"
                object :dimensions do
                  field :width, :integer
                  field :height, :integer
                end
              end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/resolvers/camera.ex
              defmodule Eye.Resolvers.Camera do

                def get_config(_parent, _args, _resolution) do
                  {:ok, Eye.Camera.get_config()}
                end

                def set_size(_parent, args, _resolution) do
                  Eye.Camera.set_size(args[:width], args[:height])
                  {:ok, Eye.Camera.get_config()}
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![graphiql](img/step4_graphiql_query.png) <!-- .element: class="plain" -->
              ![iex](img/step4_iex_query.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![graphiql](img/step4_graphiql_mutation.png) <!-- .element: class="plain" -->
              ![iex](img/step4_iex_mutation.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![test image](img/fake_640_480.jpg) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
            </textarea>
          </section>

        </section>

        <!-- Step 5 - Phoenix -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix
              ![Phoenix](img/phoenix_is_not_your_application.jpg) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step5` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step5
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              # Go back to the omni_eye directory
              # to make a new Phoenix application
              $ cd ../
              # If you don't already have the Phoenix archive installed:
              $ mix archive.install https://github.com/phoenixframework/archives/raw/master/phx_new.ez
              $ mix phx.new eye_ui --no-ecto
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              ✅ eye_ui
              ✅ ├── assets
              ✅ │   ├── brunch-config.js
              ✅ │   ├── css
              ✅ │   │   ├── app.css
              ✅ │   │   └── phoenix.css
              ✅ │   ├── js
              ✅ │   │   ├── app.js
              ✅ │   │   └── socket.js
              ✅ │   ├── node_modules
              ✅ ├── config
              ✅ │   ├── config.exs
              ✅ │   ├── dev.exs
              ✅ │   ├── prod.exs
              ✅ │   ├── prod.secret.exs
              ✅ │   └── test.exs
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              ✅ eye_ui
              ✅ ├── lib
              ✅ │   ├── eye_ui
              ✅ │   │   └── application.ex
              ✅ │   ├── eye_ui.ex
              ✅ │   ├── eye_ui_web
              ✅ │   │   ├── channels
              ❌ │   │   ├── controllers
              ✅ │   │   ├── endpoint.ex
              ✅ │   │   ├── gettext.ex
              ✅ │   │   ├── router.ex
              ❌ │   │   ├── templates
              ❌ │   │   └── views
              ✅ │   └── eye_ui_web.ex
              ✅ ├── mix.exs
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              $ cd eye_ui
              $ rm -rf lib/eye_ui_web/controllers
              $ rm -rf lib/eye_ui_web/templates
              $ rm -rf lib/eye_ui_web/views
              ```
            </textarea>
          </section>

          <section data-background-image="img/step5_move_things.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_rename_things_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_rename_things_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_remove_plug_from_eye_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_remove_plug_from_eye_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_router.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_root_plug.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_index_html.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_endpoint.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_deps.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_fw_deps.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_config.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_config_base.png" data-background-size="contain"> </section>

          <section data-markdown class="nav">
            <textarea data-template>
              ![ui config base](img/step5_eye_ui_config_dev.png) <!-- .element: class="plain" -->
              ![ui config base](img/step5_eye_ui_config_test.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step5_eye_ui_config_prod.png" data-background-size="contain"> </section>

          <section data-markdown class="nav">
            <textarea data-template>
              ![fw config](img/step5_eye_fw_config_1.png) <!-- .element: class="plain" -->
              ![fw config](img/step5_eye_fw_config_2.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step5_eye_fw_config_host.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_fw_config_target.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
              ![eye in iex](img/step5_eye_in_iex.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye_ui/assets
              $ npm install
              $ npm install -g brunch
              $ brunch build
              $ cd ../
              $ iex -S mix phx.server
              ```
              ![graphql mutation](img/step4_graphiql_mutation.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd assets
              $ brunch build --production
              $ cd ../ # to the eye_ui directory
              $ mix phx.digest
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push nerves.local
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB>
              # On Linux (probably):
              $ picocom /dev/ttyACM0
              ```
            </textarea>
          </section>

        </section>

        <!-- Step 6 - Phoenix Channels and GraphQL Subscriptions -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix Channels and
              # GraphQL Subscriptions
              ![JavaScript](img/programming_people_js.png) <!-- .element: class="plain" style="height: 12em" -->
              <br/>
              [Programming People - JavaScript](http://leftoversalad.com/c/015_programmingpeople/) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step6` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step6
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-background-image="img/step6_index_html.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ![css](img/step6_css_1.png) <!-- .element: class="plain" -->
              ![css](img/step6_css_2.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step6_schema_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_schema_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_schemas_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_resolvers_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_publisher.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_publishers_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_application.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_user_socket.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_package_json.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_3.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_4.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_5.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_6.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye_ui/assets
              $ npm install
              $ brunch build
              $ cd ../
              $ iex -S mix phx.server
              ```
              ![graphql mutation](img/step4_graphiql_mutation.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd assets
              $ brunch build --production
              $ cd ../ # to the eye_ui directory
              $ mix phx.digest
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
            </textarea>
          </section>

        </section>

        <!-- Break Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 3:00 to 3:30 PM

            * How is the pace?
            * Any questions?
            * What should we do next?
            * Mingle in the hall
            * Get a snack, maybe?
          </textarea>
        </section>

        <!-- Exercise / Lab Time -->

        <section data-markdown>
          <textarea data-template>
            # Exercise / Lab Time
          </textarea>
        </section>

        <!-- Wrap Up -->

        <section data-markdown class="nav">
          <textarea data-template>
            ## Have Fun with Nerves! 💜
            ![GregMefford](img/GregMefford.jpg) <!-- .element: class="plain" style="height: 6em" -->
            ![GregMefford](img/nerves_logo.png) <!-- .element: class="plain" style="height: 6em" -->

            Greg Mefford (@ferggo)
          </textarea>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,
        controls: false,
        progress: false,
        transition: "fade",
        width: 1920,
        height: 1080,
        center: false,
        pdfMaxPagesPerSlide: 1,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });

      for (var slide of document.getElementsByTagName('section')){
        if (slide.getAttribute('data-markdown') == "") {
          slide.setAttribute('data-separator-notes', '^Notes:');
        }

        if (!(slide.getAttribute('data-background') ||
              slide.getAttribute('data-background-image') ||
              slide.getAttribute('data-background-video') ||
              slide.getAttribute('data-background-iframe'))){
          slide.setAttribute('data-background-image', 'img/circuit.svg');
          slide.setAttribute('data-background-color', '#DFDBE5');
          slide.setAttribute('data-background-size', '200px');
          slide.setAttribute('data-background-repeat', 'repeat');
        }
      }
    </script>
  </body>
</html>
