<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Less-Pain Embedded Systems with Elixir and Nerves</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">
    <link rel="stylesheet" href="css/customizations.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="css/highlight/github.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

        <!-- Welcome -->

        <section>

          <section data-markdown class="title">
            <textarea data-template>
              # Less-Pain
              # Embedded Systems
              # with Elixir and Nerves

              ----

              ElixirConf US 2018 - 2018-09-04 + 05

              Greg Mefford &amp; Tim Mecklem

              ![GregMefford](img/headshot_glowsticks.jpeg) <!-- .element: class="plain" style="height: 6em" -->
              ![Tim Mecklem](img/tim-mecklem.jpg) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Thanks, Bleacher Report!
              ![GregMefford](img/headshot_glowsticks.jpeg) <!-- .element: class="plain" style="height: 10em" -->
              ![Bleacher Report logo](img/BR_Logo_White.png) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Thanks, Gaslight!
              ![Tim Mecklem](img/tim-mecklem.jpg) <!-- .element: class="plain" style="height: 10em" -->
              ![Gaslight logo](img/gaslight.jpg) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Code of Conduct ðŸ’œ

              http://lonestarelixir.com/2018/code-of-conduct
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule ðŸ•˜

              * 7:30 AM - 8:30 AM (1:00)
                * Registration/Breakfast
              * 8:30 AM - 10:00 AM (1:30)
                * Welcome / Overview
                * Build some Hardware
                * Pre-Burned Firmware!
                * Project Overview
              *  10:00 AM - 10:30 AM (0:30)
                * Break (and help resolve issues)
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule ðŸ•˜

              *  10:30 AM - 12:00 PM (1:30)
                * Elixir for Embedded
                * Nerves Concepts
                * Streaming Video
                * Application Structure
                * Custom Nerves Systems
              *  12:00 PM - 1:30 PM (1:30)
                * Lunch (and explore Buildroot)
            </textarea>
          </section>

          <section data-markdown class="schedule">
            <textarea data-template>
              # Tentative schedule ðŸ•˜

              *  1:30 PM - 3:00 PM (1:30)
                * Scanning Barcodes
                * GraphQL APIs
              *  3:00 PM - 3:30 PM (0:30)
                * Break
              *  3:30 PM - 5:00 PM (1:30)
                * Adding Phoenix
                * Phoenix Channels
                * GraphQL Subscriptions
                * Play / Lab time
            </textarea>
          </section>

        </section>

        <!-- Hardware Overview -->

        <section>

          <section data-background-image="img/hardware_overview.jpg" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # For Today

              * Raspberry Pi Zero W + case
              * Pi camera v2
              * Zero-size camera ribbon cable
              * Lens adjustment tool
              * 16 GB class 10 MicroSD card
              * MicroSD card reader
              * Male USB to MicroUSB cable
              * QR codes and Stickers!
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # For Later

              * MicroUSB OTG cable
              * HDMI to Mini HDMI cable
              * Standard-size camera ribbon cable
              * 5V 2.5A MicroUSB AC power adapter
              * 40-pin header
              * Heatsink
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Electronics Safety

              * Touch some grounded metal (like your laptop)
              * It's technically not fine, but it'll probably be fine
              * Be gentle with the ribbon cables/connectors
            </textarea>
          </section>

          <section data-background-image="img/hardware_assembly_01.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_02.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_07.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_06.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_03.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_04.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_05.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_06.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_07.jpg" data-background-size="contain">
          </section>

          <section data-background-image="img/hardware_assembly_08.jpg" data-background-size="contain">
          </section>

        </section>

        <!-- Quick Win Firmware / Project Overview -->

        <section>

          <section data-background-image="img/quick_win.jpg" data-background-size="contain">
          </section>

          <section data-markdown>
            <textarea data-template>
              # Eye

              ![Eye](img/eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Omni Eye

              ![Eye](img/omni_eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
              <br/>
              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Streaming Video with *Picam*
              ![Picam](img/picam.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/electricshaman/picam](https://github.com/electricshaman/picam) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Scanning Barcodes with *Zbar*
              ![zbar-elixir](img/zbar-elixir.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/GregMefford/zbar-elixir](https://github.com/GregMefford/zbar-elixir) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # GraphQL Queries, Mutations
              # and Subscriptions

              ![Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](img/graphql_subscriptions.png) <!-- .element: class="plain" style="height: 10em" -->
              <br/>
              [Live APIs with GraphQL Subscriptions - Bruce Williams and Ben Wilson](https://youtu.be/PEckzwggd78) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix Channels
              ![Channels](img/channels.png) <!-- .element: class="plain" style="height: 12em" -->

              Notes:

              Phoenix Channels also offer a great way to easily connect your devices

              to a server, whether it's an app running in a browser or

              a headless sensor device in the field.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              ![USB Gadget Power](img/gadget_power.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/nerves-project/nerves_init_gadget](https://github.com/nerves-project/nerves_init_gadget) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              ![USB Gadget Composite Device](img/gadget_composite.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/nerves-project/nerves_init_gadget](https://github.com/nerves-project/nerves_init_gadget) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              * Config Ethernet and Serial over USB
              * DHCP Server
              * mDNS Responder (`nerves.local`)
              * Manage Erlang Distribution
              * `mix firmware.push` over SSH
              * SSH console to IEx prompt
            </textarea>
          </section>

          <section data-background-image="img/eye_barcode.png" data-background-size="contain">
          </section>

          <section data-background-image="img/eye_tunnel.png" data-background-size="contain">
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ open http://nerves.local/
              # Try scanning a barcode (you may need to reload
              # the browser page after the device boots fully)

              $ open http://nerves.local/graphiql
              # Try running a query like:
              # query {
              #   config {
              #     size {
              #       width
              #       height
              #     }
              #   }
              # }
              ```
            </textarea>
          </section>

        </section>

        <!-- Break Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 10:00 to 10:30 AM

            * How is the pace?
            * Any questions?
            * Play with your shiny new hardware
            * Mingle in the hall
            * Get a snack, maybe?
          </textarea>
        </section>

        <!-- Elixir for Embedded -->

        <section>

          <section data-markdown class="nav center">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded

              Notes:
              * At Code BEAM -> don't need convincing.
              * Let's talk about _reasons_ BEAM is a good choice,
              * in case hadn't thought about it
              * or want to explain it to someone else.
            </textarea>
          </section>

          <!-- BEAM is Embedded-First -->

          <section data-markdown class="nav">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              * *BEAM is Embedded-First*
              * Baked-In Fault-Tolerance
              * Light-Weight Concurrency
              * Binary Pattern-Matching
              * Integrated IoT Platform
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # BEAM is *Embedded-First*
              ## Ericsson *ADX301*
              10 Gbps - 160 Gbps Telecom Switch System

              ![AXD301](img/ericsson_axd301.png) <!-- .element: class="plain" style="height: 12em" -->
              Notes:
              * Erlang/OTP born as control plane these telecom switches
              * Scalable total throughout by adding cards and cabinets
              * The Erlang part is to control all the ASICs on the data path

            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # BEAM is *Embedded-First*
              ## Ericsson *ADX301*
              Erlang/OTP-powered Control Plane

              ![AXD301 Control Processor Board](img/ericsson_axd301_cpu.png) <!-- .element: class="plain" -->
              Notes:
              * I wasn't able to find specs on this CPU's speed
              * I'd guess it's less-powerful than a modern Raspberry Pi
              * No surprise that we can run powerful embedded systems with Elixir
            </textarea>
          </section>

          <!-- Baked-In Fault-Tolerance -->

          <section data-markdown class="nav">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              * BEAM is Embedded-First
              * *Baked-In Fault-Tolerance*
              * Light-Weight Concurrency
              * Binary Pattern-Matching
              * Integrated IoT Platform

              Notes:
              * OTP brings FT primitives that we don't have to design

            </textarea>
          </section>

          <section data-markdown
            data-background-image="img/crash_screens.jpg"
            data-background-size="contain"
            data-separator-notes="^Notes:">
            <textarea data-template>
              ![Kevlin Henney](img/kevlin_henney.png) <!-- .element: class="plain fragment" style="height: 14em" -->

              Notes:
              * Not what they meant by "let it crash."
              * (fragment): Crash screens c/o Kevlin Henney
              * There are plenty more where these came from
            </textarea>
          </section>

          <!-- Light-Weight Concurrency -->

          <section data-markdown class="nav">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              * BEAM is Embedded-First
              * Baked-In Fault-Tolerance
              * *Light-Weight Concurrency*
              * Binary Pattern-Matching
              * Integrated IoT Platform

              Notes:
              * BEAM gives us baked-in concurrency primitives
              * via processes and message-passing
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Light-weight *concurrency*
              * Lots of tiny processes
              * Process-level fault-tolerance

              <div slye="clear: both" />
              <div style="float: left">
                <p style="margin-bottom: -36px">4 Cores</p>
                <img src="img/rpi3.png" class="plain" style="width: 950px" />
              </div>
              <div style="float: right">
                <p style="margin-bottom: -36px">96 Cores / 192 Threads</p>
                <img src="img/r930.png" class="plain" style="width: 950px" />
              </div>

              Notes:
              * Allows us to easily make use of all cores
              * Whether it's 4 in your Raspberry Pi
              * Or a bunch of hyper-threaded cores in a server
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Light-weight *concurrency*
              * Per-Process Garbage-Collection
              * Immutable Data Structures

              ![Erlang Memory Model](img/erlang_memory_model.png) <!-- .element: class="plain" style="height: 12em"-->
              <br/>
              [Hamidreza Soleimani's Blog - Erlang Garbage Collection Details and Why It Matters](https://hamidreza-s.github.io/erlang%20garbage%20collection%20memory%20layout%20soft%20realtime/2015/08/24/erlang-garbage-collection-details-and-why-it-matters.html) <!-- .element: class="attribution" -->

              Notes:
              * In particular, I want to look more closely at these two:
              * Per-process garbage-collection
              * Immutable data structures
            </textarea>
          </section>

          <section data-background-image="img/gc_jvm.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Here's what a typical memory usage graph looks like for

              a Java virtual machine under a constant workload.

              The shaded areas are wasted memory due mostly to a lack of

              immutable data structures, which prevents the garbage collector

              from quickly determining what memory is still in use somewhere.
            </aside>
          </section>

          <section data-background-image="img/gc_jvm_zoom.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              If we zoom in, we see the same process, but on a smaller scale.

              When the overall memory usage hits 75%, it triggers a Full-GC that

              stops the whole VM while it determines what memory is no longer

              referenced anywhere and frees it up.

              In a busy system, this can take a while and cause problems.
            </aside>
          </section>

          <section data-background-image="img/gc_beam.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              By contrast, the BEAM does garbage-collection on a per-process basis.

              There's very little waste for a system under constant load.

              The overall memory usage only ebbs and flows with the

              actual memory requirements of your workload.

              This means that you can run a system closer to its memory limit,

              provided that your workload doesn't have large peaks and valleys.

              That can be a very important property for an embedded system with

              only half a gig of RAM.
            </aside>
          </section>

          <section data-background-image="img/gc_beam_zoom.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              If we zoom in, we see that each process allocates some memory,

              does its work,

              with tiny, independent garbage-collections along the way,

              and frees it all when it's finished.

              At any moment, there are a bunch of processes allocating a

              small increment of memory, while a much smaller number are freeing

              their entire allocation.

              So the overall memory usage closely follows the actual demand on the system.
            </aside>
          </section>

          <!-- Binary Pattern-Matching -->

          <section data-markdown class="nav">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              * BEAM is Embedded-First
              * Baked-In Fault-Tolerance
              * Light-Weight Concurrency
              * *Binary Pattern-Matching*
              * Integrated IoT Platform

              Notes:
              * Binary pattern-mathing is super-cool for embedded
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              *Binary* Pattern-Matching

              ``` elixir
              def decode(<<op::3, addr::6, data::7>>), do: {op, addr, data}

              # ...

              decode(<<0b01010101, 0b01010011>>) # => {2, 42, 83}
              ```

              Notes:
              Let's pretend that we have an data sheet for an electronics component

              that says we need to decode these 16 bits into

              * a 3-bit operation code,
              * a 6-bit address value,
              * and a 7-bit data value.

              It's really easy to just pattern-match like this, and you're done.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              *Binary* Pattern-Matching
              ``` elixir
              def decode(<<0::2, op::1, addr::9, data::4>>), do: # ...
              def decode(<<      op::3, addr::6, data::7>>), do: # ...

              # ...

              decode(<<0b00010101, 0b01010011>>) # => {0, 341, 3}
              decode(<<0b01010101, 0b01010011>>) # => {2, 42, 83}
              ```

              Notes:

              But oh, by the way, the data sheet also says that

              if the first two bits are zeros, then you're in "extended address" mode,

              so you should interpret the rest of the data as:

              * a 1-bit operation code,
              * a 9-bit address value,
              * and a 4-bit data value.

              No problem, just add another function head.

              This example is obviously contrived, but it's so nice to be able

              to do this instead of procedural bitwise operations.
            </textarea>
          </section>

          <!-- Integrated IoT Platform -->

          <section data-markdown class="nav">
            <textarea data-template>
              # Elixir ðŸ’œ Embedded
              * BEAM is Embedded-First
              * Baked-In Fault-Tolerance
              * Light-Weight Concurrency
              * Binary Pattern-Matching
              * *Integrated IoT Platform*

              Notes:
              * Elixir is also a great choice for an integrated IoT platform.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Integrated IoT Platform
              ![Tons of cats](img/cats.png) <!-- .element: class="plain" style="height: 900px" -->

              Notes:
              This is what it looks like when all your embedded devices decide to connect to your server at once.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Integrated IoT Platform
              ![Phoenix Channels](img/channels.png) <!-- .element: class="plain" style="height: 900px" -->

              Notes:
              * If you want to, you can build a whole stack using Elixir
              * On the client and the server side
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Integrated IoT Platform
              ![Phoenix Channels](img/channels_logos.png) <!-- .element: class="plain" style="height: 900px" -->

              Notes:
              * Using Phoenix and Channels on the back-end
              * to talk to Elixir and Nerves on a headless device
              * Or to a JavaScript client running on a kiosk-style device
            </textarea>
          </section>

        </section>

        <!-- Options for Embedding Elixir -->

        <section>
          <section data-markdown class="nav">
            <textarea data-template>

              # Options for Embedding Elixir

              ![Platform Logos](img/platform_logos.png) <!-- .element: class="plain" -->

              Notes:

            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>

              ![Raspbian logo](img/logos_raspbian.png) <!-- .element: class="plain" style="height: 4em"-->
              ![Elixir logo](img/logos_elixir.png) <!-- .element: class="plain" style="height: 4em"-->
              ![Windows logo](img/logos_windows.png) <!-- .element: class="plain" style="height: 4em"-->

              * Well of course that works...
              * Deployment / Packaging
              * Administration
              * Long boot times
              * Read/Write filesystem

              Notes:

            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>

              # GRiSP

              * Bare-metal BEAM ðŸ¤˜
              * Purpose-built hardware
              * Real-time

              ![GRiSP Board](img/grisp_board.png) <!-- .element: class="plain" style="height: 800px" -->

              Notes:

            </textarea>
          </section>
        </section>

        <!-- Nerves -->

        <section>
          <section data-markdown class="nav">
            <textarea data-template>
              ![Nerves Sticker](img/nerves_sticker.png) <!-- .element: class="plain" style="height: 6em" -->

              Craft and deploy

              bulletproof embedded software

              in Elixir

              Notes:

            </textarea>
          </section>

          <section data-background-image="img/elixir_logo_on_pi.jpg">
            <aside class="notes" data-markdown>
              We basically just put Elixir on a Raspberry Pi.

              So... there you go!
            </aside>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![Nerves Sticker](img/nerves_sticker.png) <!-- .element: class="plain" style="height: 6em" -->

              * Minimal Linux with Buildroot
              * Commodity or custom hardware
              * BEAM as "operating system"
              * Read-only filesystem
              * Firmware artifacts

              Notes:

            </textarea>
          </section>

          <section data-background-image="img/nerves_vs_linux.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Nerves uses Buildroot to cross-compile a minimal Linux kernel and userland for you.

              It's much smaller than a normal Linux installation because

              it doesn't include all the drivers and tools you don't need to run your app.

              In fact, we replace the init process with a small program called erlinit,

              whose job is just to start the BEAM and run your app.
            </aside>
          </section>

          <section data-background-image="img/nerves_system.png" data-background-size="contain">
            <img class="plain fragment" src="img/rpi0.png" style="max-width: 30%" />
            <aside class="notes" data-markdown>
              The Nerves team packages these up into what we call "systems" that

              are specific to a given hardware target, like a Raspberry Pi Zero.

              The systems we provide are really minimal,

              but you can make your own if you need to.

              We have pretty good documentation about how to do that.
            </aside>
          </section>

          <section data-background-image="img/nerves_firmware.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              When you build a Nerves "firmware," it adds your application code to

              the pre-compiled system.

              Your application is responsible for running any OS processes you need,

              for example, using an Elixir Port.

              This firmware runs from a read-only file-system on the device.

              This helps prevent file system corruption when power is suddenly

              removed from an embedded device while it's writing data, and also

              give some peace of mind that the firmware you put on the device is

              going to stay in a consistent state.

              A Nerves firmware, including your application,

              can be as small as 25 MB and boots in about 5 seconds.
            </aside>
          </section>

          <section data-background-image="img/nerves_toolchain.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Of course, we also have a writable partition that you can use to

              persist your data in a place that won't corrupt your boot partition.
            </aside>
          </section>

          <section data-background-image="img/nerves_appdata.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Of course, we also have a writable partition that you can use to

              persist your data in a place that won't corrupt your boot partition.
            </aside>
          </section>

          <section data-background-image="img/nerves_b_firmware.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              We also have a secondary "firmware slot" that you can use for

              pushing updates to a running device without having to

              re-program its SD card.
            </aside>
          </section>

          <section data-markdown class="img-grid">
            <textarea data-template>
              # Support for *Lots of Targets*
              ![rpi0](img/rpi0.png) <!-- .element: class="plain" -->
              ![rpi1](img/rpi1.png) <!-- .element: class="plain" -->
              ![rpi2](img/rpi2.png) <!-- .element: class="plain" -->
              ![rpi3](img/rpi3.png) <!-- .element: class="plain" -->
              ![bbb](img/bbb.png) <!-- .element: class="plain" -->
              ![ev3](img/ev3.png) <!-- .element: class="plain" -->

              Notes:

              Nerves currently supports a bunch of popular and readily-available

              target hardware, like the Raspberry Pi and Beaglebone families,

              and the Lego EV3, which is really neat.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves Platform
              App-level fault-tolerance with *Shoehorn*
              > Get your boot on!

              * Configure network
              * Start management tooling
              * Format storage partitions
              * ... Then start your app

              Notes:

              We also have Bootloader, which can be used to ensure the device

              comes up to a known-working state before trying to start your

              application.

              This allows for some limited remote diagnostics or firmware update,

              even if your application fails to start for some reason.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves Platform
              App-level fault-tolerance with *Shoehorn*

              > *Shoehorn* used to be called *Bootloader*.
              > That was confusing because it's not actually a bootloader.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Nerves ðŸ’œ Elixir

              ```bash
              $ mix nerves.new    # Start a Project
              $ mix deps.get      # Download Artifacts
              $ mix firmware      # Cross-Compile your Code
              $ mix firmware.burn # Burn your SD card
              # ... or ...
              $ mix firmware.push # Remote Firmware Update
              ```
            </textarea>
          </section>

          <section data-background-image="img/all_in_one_nerves.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              Nerves gives you the tools you need to build, for example,

              an all-in-one touch-screen kiosk that connects to hardware devices

              and back to a central server, mostly using technologies you already know.
            </aside>
          </section>

          <section data-background-image="img/all_in_one_dev.png" data-background-size="contain">
            <aside class="notes" data-markdown>
              ... and you can use mocks of the hardware in dev and test environments

              so that you don't need to have real hardware available.
            </aside>
          </section>

        </section>

        <!-- Nerves Community -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Overwhelmingly
              # *welcoming* and *helpful*
              # community
              ![Welcome to Nerves](img/nerves_welcome.png) <!-- .element: class="plain" -->

              Notes:

              So I decided to focus on building a welcoming and helpful

              community around Nerves.

              For example, I started to manually and individually welcome each

              new person to our Slack channel

              and invite them to get involved.
            </textarea>
          </section>

          <section data-markdown
            data-background-image="img/nerves_slack_user_count.png"
            data-background-size="contain">
            <textarea data-template>
              Notes:
              The community has grown a lot.

              We have over 1500 members in our Slack channel today.

              I see that as the tip of the iceberg.

              There are probably many more people that we never hear from because

              they don't use Slack.

              We've recently been working on having a stronger presence in

              other spaces like the Elixir Forum and Stack Overflow so that we

              can do better at meeting people where they are.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # You *Can* Contribute
              ![Nerves](img/nerves_sticker.png) <!-- .element: class="plain" style="height: 10em"-->

              Notes:

            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Wanted to *get involved*
              ## Even though I was *new to Elixir*

              Notes:

              I really wanted to get more involved in the Nerves project,

              even though I was pretty new to Elixir at the time.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Wanted to *get involved*
              ## ~~Even though I was new to Elixir~~
              ## *Because* I was new to Elixir

              Notes:

              And when I thought about it, I realized that I had something to

              contribute to the project _because_ I was new to Elixir.
            </textarea>
          </section>

        </section>

        <!-- Poncho Project Structure -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Poncho Project

              ![Poncho Projects](img/poncho_projects.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [http://embedded-elixir.com/post/2017-05-19-poncho-projects/](http://embedded-elixir.com/post/2017-05-19-poncho-projects/) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Poncho Style

              ``` bash
              $ mkdir omni_eye && cd omni_eye
              $ mix new eye --sup
              $ mix phx.new eye_ui --no-ecto
              $ mix nerves.new eye_fw
              ```

              ``` bash
              omni_eye
              â”œâ”€â”€ eye
              â”œâ”€â”€ eye_fw
              â””â”€â”€ eye_ui
              ```
            </textarea>
          </section>

          <section data-background-image="img/project_eye_ui.png" data-background-size="contain">
          </section>
          <section data-background-image="img/project_logos.png" data-background-size="contain">
          </section>
          <section data-background-image="img/project_firmware.png" data-background-size="contain"> </section>
          <section data-background-image="img/project_nerves_deps.png" data-background-size="contain"> </section>
          <section data-background-image="img/project_nerves_shaded.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # *Fake Camera* for Dev and Test

              ``` elixir
              # eye/config/config.exs
              config :picam, camera: Picam.FakeCamera
              ```

              ``` elixir
              # eye_ui/config/config.exs
              config :picam, camera: Picam.FakeCamera
              ```

              ``` elixir
              # eye_fw/config/host.exs
              config :picam, camera: Picam.FakeCamera
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *Real Camera* on Target Device

              ``` elixir
              # eye_fw/config/rpi0_zbar.exs
              config :picam, camera: Picam.Camera
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # `eye` Application in `iex`
              ![iex barcodes](img/iex_scan_barcode.png) <!-- .element: class="plain" style="width: 95%" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # `eye_ui` Application in `iex`
              ![GraphiQL](img/graphiql_mutation.png) <!-- .element: class="plain" style="width: 1400px" -->
              ![mutation debug in iex](img/iex_mutation.png) <!-- .element: class="plain" style="width: 1400px" -->
            </textarea>
          </section>

        </section>

        <!-- Omni-Eye - Step 1 - Streaming Video -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Omni Eye

              ![Eye](img/omni_eye.jpg) <!-- .element: class="plain" style="height: 14em" -->
              <br/>
              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Let's Stream some Video
              ## with *Picam*

              ![Picam](img/picam.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/electricshaman/picam](https://github.com/electricshaman/picam) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step1` branch

              from the `omni_eye` repo.

              ``` bash
              $ git clone https://github.com/GregMefford/omni_eye.git
              $ cd omni_eye
              $ git checkout step1
              ```

              The following slides show how

              we arrived there step-by-step.

              [https://github.com/GregMefford/omni_eye](https://github.com/GregMefford/omni_eye) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Getting Started

              ``` bash
              $ mkdir omni_eye
              $ cd omni_eye
              $ mix new eye --sup
              $ mix nerves.new eye_fw
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Getting Started

              ``` bash
              omni_eye
              â”œâ”€â”€ eye
              â”‚Â Â  â”œâ”€â”€ README.md
              â”‚Â Â  â”œâ”€â”€ config
              â”‚Â Â  â”œâ”€â”€ lib
              â”‚Â Â  â”œâ”€â”€ mix.exs
              â”‚Â Â  â””â”€â”€ test
              â””â”€â”€ eye_fw
                  â”œâ”€â”€ README.md
                  â”œâ”€â”€ _build
                  â”œâ”€â”€ config
                  â”œâ”€â”€ deps
                  â”œâ”€â”€ lib
                  â”œâ”€â”€ mix.exs
                  â”œâ”€â”€ mix.lock.host
                  â”œâ”€â”€ rel
                  â””â”€â”€ test
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defp deps do
                [
                  {:picam, "~> 0.2.0"},
                  {:cowboy, "~> 1.0.0"},
                  {:plug, "~> 1.0"}
                ]
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/mix.exs
              defp deps do
                [
                  {:nerves, "~> 0.10.0", runtime: false},
                  {:distillery, "~> 1.5"},
                  {:eye, path: "../eye"}
                ] ++ deps(@target)
              end

              defp deps("host"), do: []
              defp deps(target) do
                [
                  {:shoehorn, "~> 0.2"},
                  {:nerves_runtime, "~> 0.5"},
                  {
                    :nerves_init_gadget,
                    github: "nerves-project/nerves_init_gadget",
                    ref: "dhcp"
                  },
                ] ++ system(target)
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # *`nerves_init_gadget`*
              * Config Ethernet and Serial over USB
              * DHCP Server
              * mDNS Responder (`nerves.local`)
              * Manage Erlang Distribution
              * `mix firmware.push` over SSH
              * SSH console to IEx prompt
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/mix.exs
              defp system("rpi0") do
                [{:nerves_system_rpi0, "~> 0.21.0", runtime: false}]
              end
              defp system(target) do
                Mix.raise "Unsupported MIX_TARGET: #{target}"
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                use Application

                def child_spec_no_args(module) do
                  %{id: module, start: {module, :start_link, []}}
                end

                def start(_type, _args) do
                  children = [
                    child_spec_no_args(Picam.Camera),
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: 80])
                  ]

                  opts = [strategy: :one_for_one, name: Eye.Supervisor]
                  Supervisor.start_link(children, opts)
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                use Plug.Router

                plug :match
                plug :dispatch
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                get "/" do
                  markup = """
                  <!DOCTYPE html>
                  <html>
                  <head>
                    <meta charset="UTF-8" />
                    <title>Eye - Video Stream</title>
                  </head>
                  <body> <img src="video.mjpg" /> </body>
                  </html>
                  """
                  conn
                  |> put_resp_header("Content-Type", "text/html")
                  |> send_resp(200, markup)
                end
                #...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                #...
                forward "/video.mjpg", to: Eye.JPEGStreamer

                match _ do
                  send_resp(conn, 404, "Oops. Try /")
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/jpeg_streamer.ex
              defmodule Eye.JPEGStreamer do
                import Plug.Conn
                @behaviour Plug
                @boundary "w58EW1cEpjzydSCq"

                def init(opts), do: opts

                def call(conn, _opts) do
                  Eye.Camera.configure()
                  conn
                  |> put_resp_header("Age", "0")
                  |> put_resp_header("Cache-Control", "no-cache, private")
                  |> put_resp_header("Pragma", "no-cache")
                  |> put_resp_header("Content-Type",
                    "multipart/x-mixed-replace; boundary=#{@boundary}")
                  |> send_chunked(200)
                  |> send_pictures
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/jpeg_streamer.ex
              defmodule Eye.JPEGStreamer do
                # ...
                defp send_pictures(conn) do
                  conn
                  |> send_picture()
                  |> send_pictures()
                end

                defp send_picture(conn) do
                  jpg = Eye.Camera.next_frame
                  size = byte_size(jpg)
                  header = "------#{@boundary}\r\nContent-Type: image/jpeg\r\nContent-length: #{size}\r\n\r\n"
                  footer = "\r\n"
                  with {:ok, conn} <- chunk(conn, header),
                       {:ok, conn} <- chunk(conn, jpg),
                       {:ok, conn} <- chunk(conn, footer),
                    do: conn
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                require Logger

                def configure do
                  Logger.info("Configuring camera")
                  Picam.set_quality(10)
                  Picam.set_size(1280, 720)
                  Picam.set_fps(30)
                end

                def next_frame do
                  Picam.next_frame()
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye_fw/config/config.exs
              config :shoehorn,
                init: [:nerves_runtime, :nerves_init_gadget],
                app: Mix.Project.config()[:app]

              # VVV Make sure you actually have an SSH key generated VVV
              config :nerves_firmware_ssh,
                authorized_keys: [
                  File.read!(Path.join(System.user_home!, ".ssh/id_rsa.pub"))
                ]
              # ^^^ Before you burn your firmware to your SD card ^^^

              config :nerves_init_gadget,
              address_method: :static

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ cd eye_fw
              $ export MIX_TARGET=rpi0
              $ mix deps.get
              $ mix firmware
              # Extract your SD card from the Zero
              # Connect it to your laptop
              $ mix firmware.burn
              # Put it back into your Zero
              ```
              ![zero retention tab](img/hardware_assembly_07.jpg) <!-- .element: class="plain" style="height: 10em" -->
              ![tilt up the zero](img/hardware_assembly_06.jpg) <!-- .element: class="plain" style="height: 10em" -->
            </textarea>
          </section>

        </section>

        <!-- Step 2 - Custom System with zbar -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Scanning Barcodes with *`zbar`*
              ![zbar-elixir](img/zbar-elixir.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://github.com/GregMefford/zbar-elixir](https://github.com/GregMefford/zbar-elixir) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Custom Nerves Systems
              ![custom system docs](img/custom_system_hexdocs.png) <!-- .element: class="plain" style="height: 13em" -->
              <br/>
              [https://hexdocs.pm/nerves/systems.html#customizing-your-own-nerves-system](https://hexdocs.pm/nerves/systems.html#customizing-your-own-nerves-system) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut
              Check out the `step2` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step2
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              # Leave the eye_fw directory
              $ cd ..
              $ git clone https://github.com/nerves-project/nerves_system_rpi0.git
              $ mv nerves_system_rpi0 system_rpi0_zbar
              $ cd system_rpi0_zbar
              $ mix deps.get
              $ mix nerves.system.shell
               Nerves /nerves/build > make menuconfig
              ```
              ![system shell](img/sys_shell_01.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/sys_shell_02.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_03.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_04.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_05.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_06.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_07.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_08.png" data-background-size="contain"> </section>
          <section data-background-image="img/sys_shell_09.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
               Nerves /nerves/build > make save-defconfig
               Nerves /nerves/build > exit
              $ git diff
              ```
            </textarea>
          </section>

          <section data-background-image="img/custom_system_diff_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_3.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_diff_4.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ cd ../omni_eye/eye_fw
              $ export MIX_TARGET=rpi0_zbar
              ```

              ``` elixir
              # eye_fw/mix.exs
              defp system("rpi0_zbar") do
                [{:nerves_system_rpi0_zbar, path: "../../system_rpi0_zbar", runtime: false}]
              end
              defp system(target) do
                Mix.raise "Unsupported MIX_TARGET: #{target}"
              end
              ```

              ``` bash
              $ mix firmware
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ mix firmware.push 192.168.24.1
              ```
              ![mix firmware push](img/firmware_push.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/custom_system_release_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_release_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/custom_system_release_3.png" data-background-size="contain"> </section>

        </section>

        <!-- Rootfs Overlays -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # *`rootfs_overlay`*
              ## Do you Need a Custom System?
              ``` elixir
              # eye_fw/config/config.exs

              config :nerves, :firmware,
                rootfs_overlay: "rootfs_overlay"
              ```
            </textarea>
          </section>

          <section data-background-image="img/nerves_overlays_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/nerves_overlays_3.png" data-background-size="contain"> </section>
          <section data-background-image="img/nerves_overlays_4.png" data-background-size="contain"> </section>

        </section>

        <!-- Lunch Time! -->

        <section data-markdown>
          <textarea data-template>
            # Lunch: 12:00 to 1:30 AM

            * Poke around in the Buildroot menus
            * Brainstorm projects
            * How is the pace?
            * Any questions?
          </textarea>
        </section>

        <!-- Step 3 - Scanning barcodes with zbar and Plug -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Let's Actually
              # Scan some Barcodes!
              ![watch barcodes](img/step3_watch_barcodes.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step3` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step3
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defmodule Eye.MixProject do
                # ...

                defp deps do
                  [
                    {:picam, "~> 0.2.0"},
                    {:zbar, "~> 0.1.0"},
                    {:cowboy, "~> 1.0.0"},
                    {:plug, "~> 1.0"},
                    {:poison, "~> 3.1.0"}
                  ]
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/config/config.exs
              config :eye, port: 4000
              config :picam, camera: Picam.FakeCamera

              config :logger, level: :debug, utc_log: true
              config :logger, :console,
                level: :debug,
                format: "$dateT$time [$level] $message\n"
              ```

              ``` elixir
              # eye_fw/config/config.exs
              config :eye, port: 80
              config :picam, camera: Picam.Camera

              config :logger, level: :info, utc_log: true
              config :logger, :console,
                level: :info,
                format: "$dateT$time [$level] $message\n"
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                # ...
                def start(_type, _args) do
                  port = Application.get_env(:eye, :port)
                  picam_camera = Application.get_env(:picam, :camera)

                  children = [
                    child_spec_no_args(picam_camera),
                    Eye.BarcodeScanner,
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: port])
                  ]

                  opts = [strategy: :rest_for_one, name: Eye.Supervisor]
                  Supervisor.start_link(children, opts)
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                use GenServer
                alias Eye.Camera

                # BarcodeScanner API

                def next_scan(timeout \\ 10_000) do
                  GenServer.call(__MODULE__, :next_scan, timeout)
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                # ...

                # GenServer API

                def start_link(opts \\ []) do
                  GenServer.start_link(__MODULE__, opts, name: __MODULE__)
                end

                def init(_opts) do
                  send(self(), :scan_next_frame)
                  {:ok, []}
                end

                def handle_call(:next_scan, from, state) do
                  {:noreply, [from | state]}
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/barcode_scanner.ex
              defmodule Eye.BarcodeScanner do
                # ...

                def handle_info(:scan_next_frame, state) do
                  {:ok, symbols} =
                    Camera.next_frame()
                    |> Zbar.scan()

                  dispatch(symbols, state)

                  send(self(), :scan_next_frame)
                  {:noreply, []}
                end

                # Helpers

                defp dispatch(symbols, requests) do
                  Enum.each(requests, & GenServer.reply(&1, symbols))
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                forward "/video.mjpg", to: Eye.JPEGStreamer

                get "/barcodes.json" do
                  response =
                    Eye.BarcodeScanner.next_scan()
                    |> format_symbols()
                    |> Poison.encode!()

                  conn
                  |> put_resp_header("Age", "0")
                  |> put_resp_header("Cache-Control", "no-cache, private")
                  |> put_resp_header("Pragma", "no-cache")
                  |> put_resp_header("Content-Type", "text/json")
                  |> send_resp(200, response)
                end

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...
                defp format_symbols(nil), do: []
                defp format_symbols(symbols) do
                  Enum.map(symbols, & format_symbol/1)
                end

                defp format_symbol(%Zbar.Symbol{} = symbol) do
                  symbol
                  |> Map.delete(:__meta__)
                  |> Map.update!(:points, & format_points/1)
                end

                defp format_points(points) do
                  Enum.map(points, & format_point/1)
                end

                defp format_point({x, y}), do: %{x: x, y: y}
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Test images
              ![test image](img/1280_720.jpg) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              If you want to try it on your laptop

              you'll need `libjpeg` and `zbar` installed.
              ``` bash
              # NOTE: the zbar package brings in a bunch of
              # other stuff, including imagemagick
              $ brew install libjpeg zbar
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
              ![iex barcodes](img/step3_iex_scan_barcode.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Push a firmware update
              ``` bash
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Serial console
              ``` bash
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
              ![picocom](img/step3_picocom.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              $ watch curl -s http://192.168.24.1/barcodes.json
              ```
              ![watch barcodes](img/step3_watch_barcodes.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

        </section>

        <!-- Step 4 - GraphQL -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # GraphQL
              ![GraphiQL](img/step4_graphiql_query.png) <!-- .element: class="plain" -->
              ![GraphiQL](img/step4_graphiql_mutation.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step4` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step4
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/configuration.ex
              defmodule Eye.Configuration do
                @moduledoc """
                This camera configuration struct holds on to the current state of each
                `Picam` camera setting that the `Eye` application supports:

                * `size`: The image resolution as a map of `%{width: w, height: h}`.
                """

                defstruct [ size: %{width: 1280, height: 720} ]

                @typedoc @moduledoc
                @type t ::
                  %__MODULE__{
                    size: dimensions()
                  }
                @type dimensions ::
                  %{width: non_neg_integer(), height: non_neg_integer()}
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                use GenServer
                alias Eye.Configuration
                require Logger

                # Public API

                def get_config(), do: GenServer.call(__MODULE__, :get_config)

                def set_size(width, height) do
                  GenServer.call(__MODULE__, {:set_size, width, height})
                end

                defdelegate next_frame(), to: Picam

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                # ...

                # GenServer API

                def start_link(opts \\ []) do
                  GenServer.start_link(__MODULE__, opts, name: __MODULE__)
                end

                def init(_opts) do
                  Logger.info("Configuring camera")
                  conf = %Configuration{}
                  Picam.set_size(conf.size.width, conf.size.height)
                  {:ok, conf}
                end
                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/camera.ex
              defmodule Eye.Camera do
                # ...

                def handle_call(:get_config, _from, conf), do: {:reply, conf, conf}

                def handle_call({:set_size, width, height}, _from, conf) do
                  case Picam.set_size(width, height) do
                    :ok ->
                      conf = %{conf | size: %{width: width, height: height}}
                      {:reply, :ok, conf}

                    err ->
                      {:reply, err, conf}
                  end
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/application.ex
              defmodule Eye.Application do
                # ...

                  children = [
                    child_spec_no_args(picam_camera),
                    Eye.Camera,
                    Eye.BarcodeScanner,
                    Plug.Adapters.Cowboy.child_spec(:http, Eye.Router, [], [port: port])
                  ]

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![remove camera config from streamer](img/step4_remove_camera_config_from_streamer.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/mix.exs
              defmodule Eye.MixProject do
                # ...

                defp deps do
                  [
                    {:picam, "~> 0.2.0"},
                    {:zbar, "~> 0.1.0"},
                    {:cowboy, "~> 1.0.0"},
                    {:plug, "~> 1.0"},
                    {:absinthe, "~> 1.4"},
                    {:absinthe_plug, "~> 1.4"},
                    {:poison, "~> 3.1.0"}
                  ]
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                use Plug.Router

                plug Plug.Logger
                plug Plug.Parsers,
                  parsers: [
                    :urlencoded,
                    :multipart,
                    :json,
                    Absinthe.Plug.Parser
                  ],
                  pass: ["*/*"],
                  json_decoder: Poison

                plug :match
                plug :dispatch

                # ...
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/router.ex
              defmodule Eye.Router do
                # ...

                forward "/graphql",
                  to: Absinthe.Plug,
                  init_opts: [schema: Eye.Schema]

                forward "/graphiql",
                  to: Absinthe.Plug.GraphiQL,
                  init_opts: [
                    schema: Eye.Schema,
                    interface: :simple
                  ]

                match _ do
                  send_resp(conn, 404, "Oops. Try /")
                end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema.ex
              defmodule Eye.Schema do
                use Absinthe.Schema

                import_types Absinthe.Type.Custom
                import_types Eye.Schema.CameraTypes

                # ...
              end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema.ex
              defmodule Eye.Schema do
                # ...
                alias Eye.Resolvers

                query name: "Query" do
                  @desc "Get current camera configuration"
                  field :config, :camera_config do
                    resolve &Resolvers.Camera.get_config/3
                  end
                end

                mutation name: "Mutation" do
                  @desc "Set camera resolution"
                  field :size, :camera_config do
                    arg :width, non_null(:integer)
                    arg :height, non_null(:integer)
                    resolve &Resolvers.Camera.set_size/3
                  end
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/schema/camera.ex
              defmodule Eye.Schema.CameraTypes do
                use Absinthe.Schema.Notation

                @desc "Camera configuration"
                object :camera_config do
                  field :size, :dimensions
                end

                @desc "Image dimensions"
                object :dimensions do
                  field :width, :integer
                  field :height, :integer
                end
              end

              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` elixir
              # eye/lib/eye/resolvers/camera.ex
              defmodule Eye.Resolvers.Camera do

                def get_config(_parent, _args, _resolution) do
                  {:ok, Eye.Camera.get_config()}
                end

                def set_size(_parent, args, _resolution) do
                  Eye.Camera.set_size(args[:width], args[:height])
                  {:ok, Eye.Camera.get_config()}
                end
              end
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![graphiql](img/step4_graphiql_query.png) <!-- .element: class="plain" -->
              ![iex](img/step4_iex_query.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![graphiql](img/step4_graphiql_mutation.png) <!-- .element: class="plain" -->
              ![iex](img/step4_iex_mutation.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ![test image](img/fake_640_480.jpg) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
            </textarea>
          </section>

        </section>

        <!-- Break Time! -->

        <section data-markdown>
          <textarea data-template>
            # Break from 3:00 to 3:30 PM

            * How is the pace?
            * Any questions?
            * Think about a project
            * Mingle in the hall
            * Get a snack, maybe?
          </textarea>
        </section>

        <!-- Step 5 - Phoenix -->

        <section>

          <section
            data-markdown
            data-background-image="img/project_logos.png"
            data-background-size="contain">
            <textarea data-template>
              # Phoenix
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step5` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step5
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              ``` bash
              # Go back to the omni_eye directory
              # to make a new Phoenix application
              $ cd ../
              # If you don't already have the Phoenix archive installed:
              $ mix archive.install https://github.com/phoenixframework/archives/raw/master/phx_new.ez
              $ mix phx.new eye_ui --no-ecto
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              âœ… eye_ui
              âœ… â”œâ”€â”€ assets
              âœ… â”‚Â Â  â”œâ”€â”€ brunch-config.js
              âœ… â”‚Â Â  â”œâ”€â”€ css
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app.css
              âœ… â”‚Â Â  â”‚Â Â  â””â”€â”€ phoenix.css
              âœ… â”‚Â Â  â”œâ”€â”€ js
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app.js
              âœ… â”‚Â Â  â”‚Â Â  â””â”€â”€ socket.js
              âœ… â”‚Â Â  â”œâ”€â”€ node_modules
              âœ… â”œâ”€â”€ config
              âœ… â”‚Â Â  â”œâ”€â”€ config.exs
              âœ… â”‚Â Â  â”œâ”€â”€ dev.exs
              âœ… â”‚Â Â  â”œâ”€â”€ prod.exs
              âœ… â”‚Â Â  â”œâ”€â”€ prod.secret.exs
              âœ… â”‚Â Â  â””â”€â”€ test.exs
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              âœ… eye_ui
              âœ… â”œâ”€â”€ lib
              âœ… â”‚Â Â  â”œâ”€â”€ eye_ui
              âœ… â”‚Â Â  â”‚Â Â  â””â”€â”€ application.ex
              âœ… â”‚Â Â  â”œâ”€â”€ eye_ui.ex
              âœ… â”‚Â Â  â”œâ”€â”€ eye_ui_web
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ channels
              âŒ â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controllers
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ endpoint.ex
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ gettext.ex
              âœ… â”‚Â Â  â”‚Â Â  â”œâ”€â”€ router.ex
              âŒ â”‚Â Â  â”‚Â Â  â”œâ”€â”€ templates
              âŒ â”‚Â Â  â”‚Â Â  â””â”€â”€ views
              âœ… â”‚Â Â  â””â”€â”€ eye_ui_web.ex
              âœ… â”œâ”€â”€ mix.exs
              ```
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              Phoenix includes a lot of stuff we won't be using.

              Let's remove it all to reduce the noise.
              ``` bash
              $ cd eye_ui
              $ rm -rf lib/eye_ui_web/controllers
              $ rm -rf lib/eye_ui_web/templates
              $ rm -rf lib/eye_ui_web/views
              ```
            </textarea>
          </section>

          <section data-background-image="img/step5_move_things.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_rename_things_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_rename_things_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_remove_plug_from_eye_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_remove_plug_from_eye_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_router.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_root_plug.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_index_html.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_endpoint.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_deps.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_fw_deps.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_config.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_ui_config_base.png" data-background-size="contain"> </section>

          <section data-markdown class="nav">
            <textarea data-template>
              ![ui config base](img/step5_eye_ui_config_dev.png) <!-- .element: class="plain" -->
              ![ui config base](img/step5_eye_ui_config_test.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step5_eye_ui_config_prod.png" data-background-size="contain"> </section>

          <section data-markdown class="nav">
            <textarea data-template>
              ![fw config](img/step5_eye_fw_config_1.png) <!-- .element: class="plain" -->
              ![fw config](img/step5_eye_fw_config_2.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step5_eye_fw_config_host.png" data-background-size="contain"> </section>
          <section data-background-image="img/step5_eye_fw_config_target.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye
              $ mix deps.get
              $ iex -S mix
              ```
              ![eye in iex](img/step5_eye_in_iex.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye_ui/assets
              $ npm install
              $ npm install -g brunch
              $ brunch build
              $ cd ../
              $ iex -S mix phx.server
              ```
              ![graphql mutation](img/step4_graphiql_mutation.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd assets
              $ brunch build --production
              $ cd ../ # to the eye_ui directory
              $ mix phx.digest
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push nerves.local
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB>
              # On Linux (probably):
              $ picocom /dev/ttyACM0
              ```
            </textarea>
          </section>

        </section>

        <!-- Step 6 - Phoenix Channels and GraphQL Subscriptions -->

        <section>

          <section data-markdown>
            <textarea data-template>
              # Phoenix Channels and
              # GraphQL Subscriptions
              ![JavaScript](img/programming_people_js.png) <!-- .element: class="plain" style="height: 12em" -->
              <br/>
              [Programming People - JavaScript](http://leftoversalad.com/c/015_programmingpeople/) <!-- .element: class="attribution" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Shortcut

              Check out the `step6` branch

              from the `omni_eye` repo.

              ``` bash
              $ git checkout step6
              ```

              The following slides show how

              we arrived there step-by-step.
            </textarea>
          </section>

          <section data-background-image="img/step6_index_html.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              ![css](img/step6_css_1.png) <!-- .element: class="plain" -->
              ![css](img/step6_css_2.png) <!-- .element: class="plain" -->
            </textarea>
          </section>

          <section data-background-image="img/step6_schema_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_schema_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_schemas_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_resolvers_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_publisher.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_publishers_barcode.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_application.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_user_socket.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_package_json.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_1.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_2.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_3.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_4.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_5.png" data-background-size="contain"> </section>
          <section data-background-image="img/step6_js_6.png" data-background-size="contain"> </section>

          <section data-markdown>
            <textarea data-template>
              # Try it in `iex`
              ``` bash
              $ cd ../eye_ui/assets
              $ npm install
              $ brunch build
              $ cd ../
              $ iex -S mix phx.server
              ```
              ![graphql mutation](img/step4_graphiql_mutation.png) <!-- .element: class="plain" style="height: 6em" -->
            </textarea>
          </section>

          <section data-markdown>
            <textarea data-template>
              # Try it on your Device
              ``` bash
              $ cd assets
              $ brunch build --production
              $ cd ../ # to the eye_ui directory
              $ mix phx.digest
              $ cd ../eye_fw
              $ mix deps.get
              $ mix firmware
              $ mix firmware.push 192.168.24.1
              # On OSX:
              $ picocom /dev/tty.usbmodem<TAB> -b 115200
              # On Linux (probably):
              $ picocom /dev/ttyACM0 -b 115200
              ```
            </textarea>
          </section>

        </section>

        <!-- Exercise / Lab Time -->

        <section data-markdown>
          <textarea data-template>
            # Exercise / Lab Time
          </textarea>
        </section>

        <!-- Wrap Up -->

        <section data-markdown class="nav">
          <textarea data-template>
            ## Have Fun with Nerves! ðŸ’œ
            ![GregMefford](img/headshot_glowsticks.jpeg) <!-- .element: class="plain" style="height: 6em" -->
            ![Nerves Logo](img/nerves_logo.png) <!-- .element: class="plain" style="height: 6em" -->
            ![Tim Mecklem](img/tim-mecklem.jpg) <!-- .element: class="plain" style="height: 6em" -->

            Greg Mefford (@ferggo)

            Tim Mecklem (@tim_mecklem)
          </textarea>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,
        controls: false,
        progress: false,
        transition: 'none',
        width: 1920,
        height: 1080,
        center: false,
        pdfMaxPagesPerSlide: 1,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });

      for (var slide of document.getElementsByTagName('section')){
        if (slide.getAttribute('data-markdown') == "") {
          slide.setAttribute('data-separator-notes', '^Notes:');
        }

        if (!(slide.getAttribute('data-background') ||
              slide.getAttribute('data-background-image') ||
              slide.getAttribute('data-background-video') ||
              slide.getAttribute('data-background-iframe'))){
          slide.setAttribute('data-background-image', 'img/circuit.svg');
          slide.setAttribute('data-background-color', '#DFDBE5');
          slide.setAttribute('data-background-size', '200px');
          slide.setAttribute('data-background-repeat', 'repeat');
        }
      }
    </script>
  </body>
</html>
